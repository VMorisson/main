<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Parc Mat√©riel</title>
  <link rel="stylesheet" href="../styles.css">
</head>
<body>
  <!-- Header commun -->
  <div id="header-placeholder"></div>
  
  <!-- Sidebar (sera charg√©e dynamiquement) -->
  <aside id="sidebar-placeholder"></aside>

  <!-- Barre r√©duite pour la sidebar -->
  <div id="collapsed-sidebar" style="display: none;">
    <div id="sidebar-label">üìÇ</div>
  </div>
  
  <!-- Contenu principal -->
  <main class="content">
    <h1>Page Parc Mat√©riel</h1>
    <p>Contenu principal ici.</p>
    <div id="dynamic-content"></div>
  </main>
  
  <!-- Conteneur pour les templates de d√©tails -->
  <div id="template-container" style="display:none;"></div>
  
  <script type="module">
    import { auth } from "../config/firebaseConfig.js";
    import { onAuthStateChanged } from "firebase/auth";
    import { initInactivityLogout } from "../config/inactivityLogout.js";
    import { loadHeader } from "../config/loadHeader.js";

    // Charger le header
    loadHeader();

    // Charger la sidebar et les templates
    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = "../index.html";
        return;
      }
      
      try {
        // Charger sidebar et templates simultan√©ment
        const [sidebarResp, templatesResp] = await Promise.all([
          fetch('../config/sidebar.html'),
          fetch('./displayTemplates.html')
        ]);
        const sidebarHTML = await sidebarResp.text();
        const templatesHTML = await templatesResp.text();
        
        document.getElementById('sidebar-placeholder').innerHTML = sidebarHTML;
        document.getElementById('template-container').innerHTML = templatesHTML;

        // Initialiser la gestion de la sidebar apr√®s son chargement
        initSidebarToggle();

        // Charger la hi√©rarchie apr√®s que la sidebar soit inject√©e
        const moduleSidebar = await import('../config/sidebarHierarchy.js');
        moduleSidebar.loadParcHierarchy();

        // Initialiser la d√©connexion pour inactivit√©
        initInactivityLogout(60000);
      } catch (error) {
        console.error("Erreur lors du chargement de la sidebar ou des templates :", error);
      }
    });

    // Fonction pour g√©rer l'affichage dynamique de la sidebar
    function initSidebarToggle() {
      console.log("‚úÖ Initialisation de la sidebar...");

      const sidebar = document.getElementById("sidebar");
      const collapsedSidebar = document.getElementById("collapsed-sidebar");
      const toggleButton = document.getElementById("toggle-sidebar-btn");
      const content = document.querySelector(".content");

      if (!sidebar || !collapsedSidebar || !toggleButton || !content) {
        console.error("‚ùå Un des √©l√©ments de la sidebar n'a pas √©t√© trouv√© !");
        return;
      }
      console.log("‚úÖ √âl√©ments trouv√©s :", { sidebar, collapsedSidebar, toggleButton });

      // Rabattre la sidebar
      toggleButton.addEventListener("click", function () {
        console.log("‚ñ∂Ô∏è Bouton de repli cliqu√© !");
        sidebar.classList.add("collapsed");
        collapsedSidebar.classList.add("visible");
        content.classList.add("sidebar-collapsed");
        console.log("‚úÖ Sidebar rabattue.");
      });

      // Red√©ployer la sidebar
      collapsedSidebar.addEventListener("click", function () {
        console.log("‚ñ∂Ô∏è Barre r√©duite cliqu√©e !");
        sidebar.classList.remove("collapsed");
        collapsedSidebar.classList.remove("visible");
        content.classList.remove("sidebar-collapsed");
        console.log("‚úÖ Sidebar r√©ouverte.");
      });
    }
  </script>
</body>
</html>
